<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:jsf="http://xmlns.jcp.org/jsf">
	
	<h:form>
		<p:remoteCommand name="initQuery" action="#{queryPage.init}"  autoRun="true"
			process="@this" update="@form" oncomplete="initOutline();" />
		<div>
			<p:textEditor widgetVar="editor" height="300" placeholder="#{bundle['query.editor.placeholder']}">
				<f:facet name="toolBar">
					<!-- leave toolbar empty for now -->
				</f:facet>
			</p:textEditor>
		</div>
		<div>
			<p:messages for="queryMsgs" closable="true" redisplay="false" skipDetailIfEqualsSummary="true" />
			<p:commandButton action="" update="queryMesgs" />
		</div>
		<div>
			<canvas id="outline" class="excerpt-outline" width="700" height="15" />			
			<div>
				<div class="color-box" style="background-color: var(--outline-bg);" />
				<h:outputText value="#{bundle['slice.color.unused']}" />
				<div class="color-box" style="background-color: var(--outline-quota);" />
				<h:outputText value="#{bundle['slice.color.quota']}" />
				<div class="color-box" style="background-color: var(--outline-excerpt);" />
				<h:outputText value="#{bundle['slice.color.excerpt']}" />
				<div class="color-box" style="background-color: var(--outline-exceeded);" />
				<h:outputText value="#{bundle['slice.color.exceeded']}" />
			</div>
		</div>
	</h:form>

				
	<h:outputScript library="js" name="xsample-common.js" target="body" />
	<h:outputScript library="js" name="xsample-slice.js" target="body" />
	<h:outputScript>	
		var excerpt = [];
		var quota = [];
		
		function updateOutline() {			
			var encodedQuota = document.getElementById('slice:excerptQuota').value;			
			quota = parseFragments(encodedQuota);
			//console.log(quota);
			
			var range = Number(document.getElementById('slice:excerptRange').value);
			var limit = Number(document.getElementById('slice:excerptThreshold').value);
			var canvas = document.getElementById('outline');
			var used = combinedSize(quota, excerpt, limit);
			var exceeded = used>limit;
			var style = exceeded ? OUTLINE_EXCEEDED : OUTLINE_EXCERPT;
		
			paintExcerpt(canvas, quota, excerpt, range, style);	
		}
		
		function initOutline() {		
			var encodedQuota = document.getElementById('slice:excerptQuota').value;			
			quota = parseFragments(encodedQuota);
			//console.log(quota);
			updateOutline();
		}
		
		$('document').ready(function(){
			initQuery();
		});
	</h:outputScript>
</ui:composition>