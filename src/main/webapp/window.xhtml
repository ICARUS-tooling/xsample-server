<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:jsf="http://xmlns.jcp.org/jsf">

	<h:head>	
    	<h:outputStylesheet name="css/primeflex.css"/>
	</h:head>
	
	<h:form>
		<div>
			<h:inputHidden id="excerptStart" value="#{xsampleData.excerpt.start}" />
			<h:inputHidden id="excerptEnd" value="#{xsampleData.excerpt.end}" />
			<h:inputHidden id="excerptRange" value="#{xsampleData.excerpt.segments}" readonly="#{true}" />
			
			<div>
				<h:outputText id="excerptRangeText" style="margin-bottom: 2em" 
					value="#{bundle['window.excerpt.from']} #{xsampleData.excerpt.start} #{bundle['window.excerpt.to']} #{xsampleData.excerpt.end}" />
				<p:slider widgetVar="excerptRangeSelect" for="excerptStart,excerptEnd" 
					display="excerptRangeText" onSlide="updateExcerpt(event, ui);" 
					style="width: 700px; margin: 2em" range="true" displayTemplate="#{bundle['window.excerpt.from']} {min} #{bundle['window.excerpt.to']} {max}" 
					minValue="1" maxValue="#{xsampleData.excerpt.segments}" />    
				<h:outputLabel for="excerptPercent" value="#{bundle['window.excerpt.size']}" />
				<h:outputText id="excerptPercent" style="margin-top: 2em" 
					value="#{xsampleData.excerpt.percent}%" />
			</div>
			<br/>
			<canvas id="excerptOutline" height="15" width="700"
				style="border:1px solid #000000; margin: 2em; display: none" />
				
			<h:commandButton value="#{bundle['window.continue']}" action="#{xsampleController.windowProgress}">
			    <f:ajax render=":content"/>
			</h:commandButton>
		</div>
	</h:form>
				
	<script type="application/javascript">
		function updateExcerpt(_, ui) {
			var begin = ui.values[0];
			var end = ui.values[1];
			var count = end - begin + 1;
			var range = Number(document.getElementById('excerptRange').value);
			var percent = Math.ceil(count / range * 100);
			document.getElementById('excerptPercent').textContent = percent + "%";
			updateOutline(begin, end, range);
		}
		
		function updateOutline(begin, end, range) {
			var c = document.getElementById('excerptOutline');
			var ctx = c.getContext("2d");
			ctx.fillStyle = "#3399ff";
			ctx.fillRect(0, 0, c.width, c.height);
			var count = end - begin + 1;
			var percent = Math.ceil(count / range * 100);
			var step = c.width / range;
			var x = (begin-1) * step;
			var width = count * step;
			ctx.fillStyle = (percent>15) ? "#FF0000":"#00FF00";
			ctx.fillRect(x, 0, width, c.height);
			c.style.display = "block";
			//console.log(ctx);
		}

		$('document').ready(function(){
			console.log('init slider bar');
		});
	</script>
</ui:composition>